#!/usr/bin/env bash

# Directory containing the projects, relative to this script's location
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_DIR="${SCRIPT_DIR}/.."
PROJECTS_DIR="${REPO_DIR}/projects"

PWD="$(pwd)"

# Find .venv directories directly under directories in the projects directory.
find "${PROJECTS_DIR}" -mindepth 2 -maxdepth 2 -type d -name ".venv" | while read -r venv_dir; do
    cd "${venv_dir}/."

    uv sync

    DIR_NAME="$(basename "$(dirname "${venv_dir}")")"

    # Install Jupyter kernel
    uv run python -m ipykernel install --user \
        --name "${DIR_NAME}" --display-name "${DIR_NAME}"

done

cd "${PWD}"
